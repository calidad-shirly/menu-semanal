<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Planificador de Men√∫ Semanal ‚Äî 1 adulto + 1 ni√±o</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Peque√±as mejoras visuales */
    textarea { resize: vertical; min-height: 44px; }
    .cell-area { min-height: 64px; }
  </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-white min-h-screen p-6">
  <div class="max-w-6xl mx-auto">
    <header class="mb-6">
      <h1 class="text-3xl font-bold text-green-800 flex items-center gap-3">
        üçΩÔ∏è Planificador de Men√∫ Semanal ‚Äî 1 Adulto üë©‚Äçü¶∞ + 1 Ni√±o üßí
      </h1>
      <p class="text-gray-600 mt-2">Rellena o genera sugerencias saludables. Obt√©n al final la lista de la compra basada en los platos elegidos.</p>
    </header>

    <section class="mb-4 p-4 bg-white rounded-2xl shadow-sm">
      <div class="flex flex-wrap gap-2">
        <button id="suggestBtn" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg">‚ú® Sugerir platos</button>
        <button id="shoppingBtn" class="px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg">üõí Generar lista de la compra</button>
        <button id="clearBtn" class="px-4 py-2 bg-red-400 hover:bg-red-500 text-white rounded-lg">‚ôªÔ∏è Limpiar tabla</button>
        <button id="exportCSVBtn" class="px-4 py-2 bg-yellow-500 hover:bg-yellow-600 text-white rounded-lg">üì• Exportar lista (CSV)</button>
      </div>
      <p class="text-sm text-gray-500 mt-2">Las sugerencias est√°n pensadas para ofrecer combinaciones equilibradas (prote√≠na + carbohidrato + verduras/fruta) adaptadas a adulto y ni√±o.</p>
    </section>

    <main class="overflow-x-auto bg-white rounded-2xl p-4 shadow-sm">
      <!-- Tabla -->
      <table class="w-full table-auto border-collapse">
        <thead>
          <tr>
            <th class="p-2 sticky top-0 bg-white text-left">Comida / D√≠a</th>
            <!-- D√≠as -->
            <th class="p-2 text-center bg-green-50">Lun<br/><span class="text-xs text-gray-500">L</span></th>
            <th class="p-2 text-center bg-green-50">Mar</th>
            <th class="p-2 text-center bg-green-50">Mi√©</th>
            <th class="p-2 text-center bg-green-50">Jue</th>
            <th class="p-2 text-center bg-green-50">Vie</th>
            <th class="p-2 text-center bg-green-50">S√°b</th>
            <th class="p-2 text-center bg-green-50">Dom</th>
          </tr>
        </thead>
        <tbody>
          <!-- Filas: Desayuno, Almuerzo, Cena -->
          <tr class="align-top">
            <td class="p-2 font-medium">Desayuno ü•£</td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Lun" data-meal="desayuno" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Mar" data-meal="desayuno" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Mi√©" data-meal="desayuno" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Jue" data-meal="desayuno" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Vie" data-meal="desayuno" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="S√°b" data-meal="desayuno" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Dom" data-meal="desayuno" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
          </tr>

          <tr class="align-top">
            <td class="p-2 font-medium">Almuerzo üç≤</td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Lun" data-meal="almuerzo" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Mar" data-meal="almuerzo" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Mi√©" data-meal="almuerzo" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Jue" data-meal="almuerzo" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Vie" data-meal="almuerzo" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="S√°b" data-meal="almuerzo" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Dom" data-meal="almuerzo" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
          </tr>

          <tr class="align-top">
            <td class="p-2 font-medium">Cena üåÆ</td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Lun" data-meal="cena" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Mar" data-meal="cena" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Mi√©" data-meal="cena" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Jue" data-meal="cena" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Vie" data-meal="cena" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="S√°b" data-meal="cena" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
            <td class="p-2"><textarea class="w-full border rounded-md p-2 cell-area" data-day="Dom" data-meal="cena" placeholder="Adulto: ... \nNi√±o: ..."></textarea></td>
          </tr>
        </tbody>
      </table>
    </main>

    <!-- Lista de compra -->
    <aside id="shoppingListArea" class="mt-6 bg-white rounded-2xl p-4 shadow-sm hidden">
      <h2 class="text-xl font-semibold mb-2">üõí Lista de la compra generada</h2>
      <p class="text-sm text-gray-600 mb-2">Basada en los platos seleccionados o sugeridos. (Se agrupan ingredientes repetidos.)</p>
      <ul id="shoppingList" class="list-disc pl-6 text-gray-800"></ul>
    </aside>

    <footer class="mt-6 text-sm text-gray-500">
      <p>Instrucciones: usa <strong>"Sugerir platos"</strong> para auto-completar un men√∫ equilibrado; edita las celdas si lo deseas; luego pulsa <strong>"Generar lista de la compra"</strong> para obtener los ingredientes.</p>
    </footer>
  </div>

  <script>
    // --- Datos: platos balanceados para adulto y ni√±o con sus ingredientes ---
    const balancedMeals = {
      desayuno: [
        {
          adult: "Avena con frutas y nueces",
          child: "Avena con pl√°tano y miel",
          ingredients: ["Avena", "Leche o bebida vegetal", "Pl√°tano", "Frutas rojas", "Nueces", "Miel"]
        },
        {
          adult: "Tostada integral con aguacate y huevo",
          child: "Tostada integral con huevo revuelto",
          ingredients: ["Pan integral", "Aguacate", "Huevos", "Tomate"]
        },
        {
          adult: "Yogur natural con granola y frutos",
          child: "Yogur natural con manzana rallada",
          ingredients: ["Yogur natural", "Granola", "Manzana", "Miel"]
        }
      ],
      almuerzo: [
        {
          adult: "Pechuga de pollo a la plancha + quinoa + ensalada",
          child: "Tiritas de pollo + arroz + zanahoria al vapor",
          ingredients: ["Pechuga de pollo", "Quinoa", "Lechuga", "Tomate", "Arroz", "Zanahoria"]
        },
        {
          adult: "Filete de pescado + pur√© de papa + br√≥coli",
          child: "Pescado empanado al horno + pur√© de papa",
          ingredients: ["Filete de pescado", "Papas", "Br√≥coli", "Lim√≥n"]
        },
        {
          adult: "Lentejas estofadas con verduras",
          child: "Lentejas suaves con zanahoria",
          ingredients: ["Lentejas", "Cebolla", "Zanahoria", "Pimiento", "Caldo"]
        }
      ],
      cena: [
        {
          adult: "Ensalada templada con salm√≥n",
          child: "Wrap de pollo y vegetales (sin salsa picante)",
          ingredients: ["Salm√≥n", "Mezcla de hojas", "Tortilla integral", "Pollo", "Pepino"]
        },
        {
          adult: "Tortilla de verduras + pan integral",
          child: "Tortilla suave de queso y verduras",
          ingredients: ["Huevos", "Calabac√≠n", "Pimiento", "Pan integral", "Queso rallado"]
        },
        {
          adult: "Sopa de verduras y filete peque√±o",
          child: "Sopa de fideos con pollo desmenuzado",
          ingredients: ["Caldo de verduras", "Fideos", "Pollo", "Zanahoria", "Apio"]
        }
      ]
    };

    // Referencias DOM
    const suggestBtn = document.getElementById('suggestBtn');
    const shoppingBtn = document.getElementById('shoppingBtn');
    const clearBtn = document.getElementById('clearBtn');
    const exportCSVBtn = document.getElementById('exportCSVBtn');
    const textareas = Array.from(document.querySelectorAll('textarea'));
    const shoppingListArea = document.getElementById('shoppingListArea');
    const shoppingListEl = document.getElementById('shoppingList');

    // Rellenar sugerencias aleatorias equilibradas
    suggestBtn.addEventListener('click', () => {
      // Para cada meal/day textarea
      textareas.forEach(txt => {
        const meal = txt.dataset.meal; // desayuno/almuerzo/cena
        const pool = balancedMeals[meal];
        const choice = pool[Math.floor(Math.random() * pool.length)];
        // Formato: Adulto: ... \n Ni√±os: ...
        txt.value = `Adulto: ${choice.adult}\nNi√±o: ${choice.child}`;
        // Guardar ingredientes en data attr (JSON)
        txt.dataset.ingredients = JSON.stringify(choice.ingredients);
      });
      alert('Se han generado sugerencias saludables para cada comida. Puedes editarlas si quieres.');
    });

    // Limpiar tabla
    clearBtn.addEventListener('click', () => {
      if (!confirm('¬øSeguro que quieres limpiar toda la tabla y empezar de nuevo?')) return;
      textareas.forEach(t => {
        t.value = '';
        delete t.dataset.ingredients;
      });
      shoppingListArea.classList.add('hidden');
    });

    // Generar lista de la compra
    shoppingBtn.addEventListener('click', () => {
      const ingredientsSet = new Set();

      textareas.forEach(t => {
        // Si hay data-ingredients (sugerido), usarlos
        if (t.dataset.ingredients) {
          try {
            const arr = JSON.parse(t.dataset.ingredients);
            arr.forEach(i => ingredientsSet.add(normalize(i)));
            return;
          } catch (e) {
            // ignore and try to parse value
          }
        }
        // Si no hay data-ingredients, intentar inferir por texto
        const raw = t.value.trim();
        if (!raw) return;
        // Buscamos por l√≠neas "Adulto: X" y "Ni√±o: Y", y tratamos de buscar match exacto en balancedMeals
        const lines = raw.split('\n').map(s => s.trim()).filter(Boolean);
        lines.forEach(l => {
          // quitar prefijos
          const after = l.replace(/^Adulto:\s*/i, '').replace(/^Ni√±[oa]:\s*/i, '').trim();
          // intentar buscar en mapping por igualdad de texto
          const found = findIngredientsByDishName(after);
          if (found) {
            found.forEach(i => ingredientsSet.add(normalize(i)));
          } else {
            // fallback: tomar palabras separadas por coma
            after.split(',').map(x => x.trim()).filter(Boolean).forEach(x => ingredientsSet.add(normalize(x)));
          }
        });
      });

      // Mostrar lista
      const list = Array.from(ingredientsSet).sort();
      shoppingListEl.innerHTML = '';
      if (list.length === 0) {
        shoppingListEl.innerHTML = '<li class="text-gray-600">No se encontraron ingredientes (fila vac√≠a o texto no reconocido).</li>';
      } else {
        list.forEach(item => {
          const li = document.createElement('li');
          li.textContent = item;
          shoppingListEl.appendChild(li);
        });
      }
      shoppingListArea.classList.remove('hidden');
    });

    // Export CSV simple para la lista de la compra
    exportCSVBtn.addEventListener('click', () => {
      const items = Array.from(shoppingListEl.querySelectorAll('li')).map(li => li.textContent).filter(Boolean);
      if (items.length === 0) { alert('Primero genera la lista de la compra.'); return; }
      const csvContent = "data:text/csv;charset=utf-8," + encodeURIComponent(items.join('\n'));
      const link = document.createElement('a');
      link.setAttribute('href', csvContent);
      link.setAttribute('download', 'lista_compra.csv');
      document.body.appendChild(link);
      link.click();
      link.remove();
    });

    // Helpers
    function normalize(s) {
      return s.trim().replace(/\s+/g, ' ');
    }

    function findIngredientsByDishName(dishName) {
      if (!dishName) return null;
      const name = dishName.toLowerCase();
      for (const mealType of Object.keys(balancedMeals)) {
        for (const obj of balancedMeals[mealType]) {
          if (obj.adult.toLowerCase() === name || obj.child.toLowerCase() === name) return obj.ingredients;
        }
      }
      // Intentar b√∫squeda parcial (si el usuario escribi√≥ "avena" por ejemplo)
      for (const mealType of Object.keys(balancedMeals)) {
        for (const obj of balancedMeals[mealType]) {
          if (obj.adult.toLowerCase().includes(name) || obj.child.toLowerCase().includes(name)) return obj.ingredients;
        }
      }
      return null;
    }
  </script>
</body>
</html>
